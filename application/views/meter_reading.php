<main class="workspace">
    <section class="breadcrumb">
        <ul>
            <li><a href="#">Master</a></li>
            <li class="divider la la-arrow-right"></li>
            <li>User Assign</li>
        </ul>
    </section>

        <div class="lg:flex lg:-mx-4">
            <div class="w-full lg:px-4">
                <div class="card p-5">
                    <form class="">
                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Billing Period</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">To</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="mb-4 xl:w-1/4">
                            <label class="label block mb-2" for="slug">Bill No.</label>
                            <input id="slug" type="text" class="form-control">
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Date Of Bill</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Due Date</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>
                        <hr/>
                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Current Reading</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Current Reading Date</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Previous Reading</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Previous Reading Date</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Coefficient</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Power Consumption</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Power Factor</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Total Consumption</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Highest Demand Reading</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>
                        <hr/>
                        For Any Issue,Contact :
                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">JE/AE Name</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Contact No.</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>
                        IF Not Resolved in 7 Days, Contact :
                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">AE/EE Name</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Contact No.</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>
                        <hr/>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Fixed/Demand Charges</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Minimum charges</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="mb-4 xl:w-1/4 ml-2">
                            <label class="label block mb-2" for="slug">Energy charges</label>
                            <input id="slug" type="text" class="form-control">
                        </div>

                        <div class="mb-4 xl:w-1/4 ml-2">
                            <label class="label block mb-2" for="slug">Sum</label>
                            <input id="slug" type="text" class="form-control">
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Electricity Duty</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Energy Development Cess</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Welding/Capacitor Overload</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Meter Fare</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">VCA Charge</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Additional Security Deposit</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Special concession Amount</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Total Bill</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Deviation/Adjustment</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Past Due</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Security fund Outstanding</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Net Payable Amount</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Extra</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex">
                            <div class="mb-4 xl:w-1/4">
                                <label class="label block mb-2" for="title">Gross Payable Amount including surcharge</label>
                                <input id="title" type="text" class="form-control">
                            </div>
                            <div class="mb-4 xl:w-1/4 ml-2">
                                <label class="label block mb-2" for="slug">Overload</label>
                                <input id="slug" type="text" class="form-control">
                            </div>
                        </div>

                        <div class="flex w-1/4">
                            <label class="input-group text-base font-normal" for="customFile">
                                <div class="file-name input-addon input-addon-prepend input-group-item w-full overflow-x-hidden">
                                    No file chosen</div>
                                <input id="customFile" type="file" class="hidden">
                                <div class="input-group-item btn btn_primary uppercase">Choose File</div>
                            </label>
                        </div>

                        <div class="mt-12 text-center">
                          <input type="submit" class="btn btn_success mt-5 ltr:mr-2 rtl:ml-2 uppercase" id="company-create" value="Submit">
                          <button class="btn btn_secondary mt-5 ltr:mr-2 rtl:ml-2 uppercase" id="company-update">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
    


    <script>
    const baseUrl = $('#base_url').val();
/////////

function getCostCenter(cid){
    $.ajax({
        url: `${baseUrl}Costcenter_ctrl/getCostcenterByCompnayId/${cid}`,
        method: "POST",
        dataType: "json",
        data : {
            cid : $(this).data('id')
        },
        success(response){
            var x = '<option value="">Select Cost-center</option>';
            if(response.status == 200){
                $.each(response.data,function(key,value){
                    x = x + '<option value="'+ value.costc_id +'">'+ value.name +'</option>';
                });
                $('#costc_id').html(x);
            }
            $('#costc_id').html(x);
        }
    });
}

function getLocations(cid){
    $.ajax({
        url: `${baseUrl}Location_ctrl/getLocationByCostcenterId/${cid}`,
        method: "POST",
        dataType: "json",
        data : {
            cid : $(this).data('id')
        },
        success(response){
            var x = '<option value="">Select Location</option>';
            if(response.status == 200){
                $.each(response.data,function(key,value){
                    x = x + '<option value="'+ value.loc_id +'">'+ value.name +'</option>';
                });
                $('#loc_id').html(x);
            }
            $('#loc_id').html(x);
        }
    });
}

function getMeters(lid){
    $.ajax({
        url: `${baseUrl}Meter_ctrl/getMeterByLocationId/${lid}`,
        method: "POST",
        dataType: "json",
        success(response){
            var x = '<option value="">Select Location</option>';
            if(response.status == 200){
                $.each(response.data,function(key,value){
                    x = x + '<option value="'+ value.mid +'">'+ value.bpno +'</option>';
                });
                $('#meter').html(x);
            }
            $('#meter').html(x);
        }
    });
}

function getSubMeters(mid){
    $.ajax({
        url: `${baseUrl}Meter_ctrl/getSubMeters/${mid}`,
        method: "POST",
        dataType: "json",
        success(response){
            var x = '<option value="">Select sub meter</option>';
            if(response.status == 200){
                $.each(response.data,function(key,value){
                    x = x + '<option value="'+ value.mid +'">'+ value.bpno +'</option>';
                });
                $('#sub-meter').html(x);
            }
            $('#sub-meter').html(x);
        }
    });
}


      $(document).on('change','#company',function(){
          var cid = $(this).val();
        getCostCenter(cid);
      });

      $(document).on('change','#costc_id',function(){
          var cid = $(this).val();
          getLocations(cid);
      });

      $(document).on('change','#loc_id',function(){
          var lid = $(this).val();
          getMeters(lid);
      });

      $(document).on('change','#meter',function(){
          var mid = $(this).val();
          getSubMeters(mid);
      });

    
      $(document).on('click','.costcenter_edit',function(){
        var request = $.ajax({
                url: `${baseUrl}Costcenter_ctrl/getCostCenterById`,
                method: "POST",
                data: { cid : $(this).data('id') },
                dataType: "json"
                });    
            request.done(function( response ) {
                console.log(response);
                if(response.status == 200){
                    $('#costcenter-update').show();
                    $('#cancel-btn').show();
                    $('#costcenter-create').hide();
                    $('#reset-btn').hide();

                    $('#cid').val(response.data['costc_id']);
                    $('#company').val(response.data['company_id']);
                    $('#cname').val(response.data['name']);
                }
            });
            request.fail(function( jqXHR, textStatus ) {
            alert( "Request failed: " + textStatus );
            });
      });

      $('#cancel-btn').on('click',function(){
            $('#costcenter-update').hide();
            $('#cancel-btn').hide();
            $('#costcenter-create').show();
            $('#reset-btn').show();
      });


      $(document).on('click','.costcenter_delete',function(){
        $.ajax({
            url: `${baseUrl}Costcenter_ctrl/delete_costcenter`,
            method: "POST",
            dataType: "json",
            data : {
                cid : $(this).data('id')
            },
            beforeSend(){
                $('#costcenterList').html('<tr><td colspan="6"><p class="text-center">Loading..</p></td></tr>');
            },
            success(response){
                alert(response.msg);
                if(response.status == 200){
                    reload();
                }
            }
        });
      });


      

      function reload(){
        $.ajax({
            url: `${baseUrl}Costcenter_ctrl/getCostcenters`,
            method: "GET",
            dataType: "json",
            beforeSend(){
                $('#costcenterList').html('<tr><td colspan="6"><p class="text-center">Loading..</p></td></tr>');
            },
            success(response){
                if(response.status == 200){
                    var x = '';
                    $.each(response.data,function(key,value){
                        x = x + '<tr>'+
                                        '<td class="text-center">'+ parseInt(key+1) +'</td>'+
                                        '<td class="text-center">'+ value.name +'</td>'+
                                        '<td class="text-center">'+ value.company_name + '</td>'+
                                        '<td class="text-center">'+ value.created_at +'</td>'+
                                        '<td class="text-center">'+ value.fname + ' '+ value.lname +'</td>'+
                                        '<td class="text-center">'+
                                            '<a href="javascript:void(0);" class="costcenter_edit" data-id="'+ value.costc_id +'"><i class="la la-pencil"></i></a>'+
                                            '<a href="javascript:void(0);" class="costcenter_delete" data-id="'+ value.costc_id +'"><i class="la la-trash"></i></a>'+
                                        '</td>'+
                                    '</tr>';

                        $('#costcenterList').html(x);
                    })
                }
            }
        });
      }


    </script>
